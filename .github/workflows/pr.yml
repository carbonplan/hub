name: staging to prod
on:
  push:
    branches:
      - staging
jobs:
  stagingToProd:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          ref: prod
          fetch-depth: 0  # 0 indicates all history for all branches and tags.
      - name: get commits
        run: |
          COMMITS=$(git log --oneline --no-merges remotes/origin/prod...remotes/origin/staging --)
          echo "::set-env name=COMMITS::$COMMITS"
      - name: pull-request
        uses: repo-sync/pull-request@v2
        with:
          source_branch: "staging"
          destination_branch: "prod"
          pr_title: prod <- staging
          pr_body: |
            Updates <code>prod</code> from <code>staging</code>.

            <details>
            <summary>Commits</summary>
            ${COMMITS}
            </details>
          github_token: ${{ secrets.GITHUB_TOKEN }}
